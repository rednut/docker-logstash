#
#
#
#2014-09-17 00:33:12,946 fail2ban.actions[26181]: WARNING [ssh] Unban 61.174.51.216
filter {
	if [type] == "syslog" {
		grok {
			match => [ "message", "^%{TIMESTAMP_ISO8601:timestamp} fail2ban\.server.*\[%{NUMBER:program_pid}\]: %{WORD:level}.*%{GREEDYDATA:message}",
			           "message", "^%{TIMESTAMP_ISO8601:timestamp} fail2ban\.jail.*\[%{NUMBER:program_pid}\]: %{WORD:level}.*%{GREEDYDATA:message}" ]
			add_tag => [ "fail2ban_server" ]
			tag_on_failure => [] 
		}
		grok {
			match => [ "message", "^%{TIMESTAMP_ISO8601:timestamp} fail2ban\.actions\[%{NUMBER:program_pid}\]: %{WORD:level} \[%{WORD:program}\] %{WORD:action} %{IP:ip}" ]
			add_tag => [ "fail2ban_actions", "%{action}" ]
			tag_on_failure => []
		}

#		date {
##        		match => [ "timestamp", "yyyy-MM-dd HH:mm:ss,SSS", "MMM dd HH mm ss" ]
#      		}
	}

	if "fail2ban_server" in [tags] {
	        mutate {
			replace => [ "type", "fail2ban" ]
		}
	}

	if "fail2ban_actions" in [tags] {

             geoip {
                        source => "ip"
                        target => "geoip"
                        add_tag => [ "geoip" ]
                       add_field => [
                          "[geoip][coordinates]", "%{[geoip][longitude]}",
                          "[geoip][coordinates]", "%{[geoip][latitude]}"
                        ]
               }
               mutate {
                     convert => [ "[geoip][coordinates]", "float" ]
		     replace => [ "type", "fail2ban" ]
               }

	}
}


#014-09-15 22:31:58,148 fail2ban.actions[1886]: WARNING [ssh] Ban 61.174.51.227
#2014-09-15 22:34:41,650 fail2ban.server [1886]: INFO    Stopping all jails
#2014-09-15 22:34:42,414 fail2ban.actions[1886]: WARNING [ssh] Unban 61.174.51.227
#2014-09-15 22:34:42,451 fail2ban.jail   [1886]: INFO    Jail 'ssh' stopped
#2014-09-15 22:34:42,494 fail2ban.server [1886]: INFO    Exiting Fail2ban
#2014-09-15 22:34:44,794 fail2ban.server [26467]: INFO    Changed logging target to /var/log/fail2ban.log for Fail2ban v0.8.13
