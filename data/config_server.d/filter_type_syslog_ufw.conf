filter {

	if [type] == "syslog" {

		grok {
        		match => [
                		"message", "\\[.*%{BASE10NUM:uptime}\\] \\[UFW BLOCK\\] %{GREEDYDATA:ufw_block}"
                	]
                	add_tag => [ "ufw-block", "ufw" ]
                	break_on_match => false
			tag_on_failure => []
			
        	}
             grok {
                        match => [
                                "message", "\\[.*%{BASE10NUM:uptime}\\] \\[UFW AUDIT\\] %{GREEDYDATA:ufw_block}"
                        ]
                        add_tag => [ "ufw-audit", "ufw" ]
                        break_on_match => false
                        tag_on_failure => []

                }

	}

	if "ufw" in [tags]  {
	              
		#
                kv {
                	source => "ufw_block"
                        field_split => " "
			
		}
		 geoip {
                        source => "SRC" 
                        target => "SRC_geoip"
                        add_tag => [ "geoip" ]
                        add_field => [
                           "[SRC_geoip][coordinates]", "%{[SRC_geoip][longitude]}",
                           "[SRC_geoip][coordinates]", "%{[SRC_geoip][latitude]}"
                         ]
                }
		 geoip {
                        source => "DST"
                        target => "DST_geoip"
                        add_tag => [ "geoip" ]
                        add_field => [
                           "[DST_geoip][coordinates]", "%{[DST_geoip][longitude]}",
                           "[DST_geoip][coordinates]", "%{[DST_geoip][latitude]}"
                         ]
                }


                mutate {
                      convert => [
                        "[SRC_geoip][coordinates]", "float",
			"[DST_geoip][coordinates]", "float"
		      ]
		}
	
		mutate {
			replace => [
					 "message", "%{ufw_block}",
					"type", "ufw"
				  ] 
			remove_field => [ "ufw_block" ]
			convert => [
				"LEN", "integer",
				#"DPT", "integer",
				#"SPT", "integer",
				"ID",  "integer",
				"TTL", "integer"
			]			
		}
			
	}

}

# IN=docker0 OUT= PHYSIN=vethbf7e MAC=56:84:7a:fe:97:99:be:f7:d1:ef:d1:01:08:00 SRC=172.17.0.2 DST=10.9.1.9 LEN=67 TOS=0x00 PREC=0x00 TTL=64 ID=41201 DF PROTO=UDP SPT=52406 DPT=53 LEN=47
